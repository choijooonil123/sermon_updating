<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì„¤êµ ì½ê¸° ë° ìŒì„± ìˆ˜ì •</title>
  <style>
    body { font-family: Arial; margin: 40px; background: #f0f8ff; }
    textarea { width: 100%; height: 200px; font-size: 1em; padding: 10px; }
    button { margin: 5px; padding: 10px 15px; font-size: 1em; }
    #status { margin-top: 10px; font-weight: bold; color: #003366; }
  </style>
</head>
<body>

<h1>ğŸ“– ì„¤êµ ì½ê¸° ë° ìŒì„± ìˆ˜ì • ì‹œìŠ¤í…œ</h1>

<textarea id="sermonInput" placeholder="ì—¬ê¸°ì— ì„¤êµë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”. ë¬¸ì¥ì€ ë§ˆì¹¨í‘œë¡œ êµ¬ë¶„í•´ì£¼ì„¸ìš”."></textarea><br>
<button onclick="startSermon()">ğŸ”Š ì„¤êµ ì‹œì‘</button>
<button onclick="startVoiceCommand()">ğŸ¤ ìŒì„± ëª…ë ¹</button>
<button onclick="undoEdit()">â†©ï¸ ì´ì „ ìƒíƒœ</button>

<p id="status">ìƒíƒœ ë©”ì‹œì§€</p>

<script>
  let sermonSentences = [];
  let currentIndex = 0;
  let sermonHistory = [];

  function startSermon() {
    const text = document.getElementById("sermonInput").value;
    if (!text.trim()) {
      alert("ì„¤êµë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”.");
      return;
    }
    sermonSentences = text.split(/(?<=\.)\s*/); // ë§ˆì¹¨í‘œ ë’¤ ë¶„í• 
    currentIndex = 0;
    sermonHistory = [text]; // ì´ˆê¸° ì €ì¥
    speakNext();
  }

  function speakNext() {
    if (currentIndex >= sermonSentences.length) {
      document.getElementById("status").textContent = "ğŸ“˜ ì„¤êµ ì™„ë£Œ";
      return;
    }
    const utterance = new SpeechSynthesisUtterance(sermonSentences[currentIndex]);
    utterance.lang = 'ko-KR';
    utterance.onend = () => {
      currentIndex++;
      speakNext();
    };
    document.getElementById("status").textContent = `ğŸ—£ï¸ ${currentIndex + 1}ë²ˆì§¸ ë¬¸ì¥ ì½ëŠ” ì¤‘...`;
    speechSynthesis.speak(utterance);
  }

  function startVoiceCommand() {
    if (!('webkitSpeechRecognition' in window)) {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      return;
    }

    const recognition = new webkitSpeechRecognition();
    recognition.lang = "ko-KR";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    recognition.start();

    document.getElementById("status").textContent = "ğŸ¤ ìŒì„± ëª…ë ¹ ë“£ëŠ” ì¤‘...";

    recognition.onresult = function(event) {
      const command = event.results[0][0].transcript.trim();
      document.getElementById("status").textContent = "ğŸ“ ì¸ì‹ë¨: " + command;
      applyVoiceCommand(command);
    };

    recognition.onerror = function(event) {
      document.getElementById("status").textContent = "âŒ ì˜¤ë¥˜: " + event.error;
    };
  }

function applyVoiceCommand(command) {
  // 1. ì•ë¬¸ì¥ë¶€í„° ë‹¤ì‹œ ì½ì–´ì¤˜
  if (command.includes("ì•ë¬¸ì¥ë¶€í„° ë‹¤ì‹œ") || command.includes("ì´ì „ ë¬¸ì¥ë¶€í„° ë‹¤ì‹œ")) {
    if (currentIndex > 1) {
      currentIndex -= 2;  // ë°©ê¸ˆ ì½ì€ ë¬¸ì¥ì˜ 'ì´ì „ ë¬¸ì¥'ë¶€í„° ë‹¤ì‹œ
    } else {
      currentIndex = 0;
    }
    speakNext();
    return;
  }

  // 2. í˜„ì¬ ë¬¸ì¥ ìˆ˜ì •
  const match = command.match(/í˜„ì¬ ë¬¸ì¥ì„ (.+)ë¡œ ë°”ê¿”ì¤˜/);
  if (match && match[1]) {
    sermonHistory.push(document.getElementById("sermonInput").value); // ì €ì¥
    const newSentence = match[1].trim();

    if (currentIndex - 1 >= 0 && currentIndex - 1 < sermonSentences.length) {
      sermonSentences[currentIndex - 1] = newSentence + ".";
      updateTextarea();
      document.getElementById("status").textContent = "âœï¸ í˜„ì¬ ë¬¸ì¥ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.";
    } else {
      document.getElementById("status").textContent = "â— ì½ê³  ìˆëŠ” ë¬¸ì¥ì´ ì—†ìŠµë‹ˆë‹¤.";
    }
    return;
  }

  document.getElementById("status").textContent = "â— ëª…ë ¹ì–´ë¥¼ ì´í•´í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
}


  function updateTextarea() {
    document.getElementById("sermonInput").value = sermonSentences.join(" ");
  }

  function undoEdit() {
    if (sermonHistory.length > 0) {
      const prev = sermonHistory.pop();
      document.getElementById("sermonInput").value = prev;
      sermonSentences = prev.split(/(?<=\.)\s*/);
      currentIndex = 0;
      document.getElementById("status").textContent = "â†©ï¸ ì´ì „ ìƒíƒœë¡œ ë³µì›í–ˆìŠµë‹ˆë‹¤.";
    } else {
      document.getElementById("status").textContent = "â— ë˜ëŒë¦´ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.";
    }
  }
</script>

</body>
</html>
